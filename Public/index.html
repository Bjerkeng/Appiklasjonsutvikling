<!DOCTYPE html>

<html>
<head>
  <meta charset="utf-8" />
  <title>TodoList </title>
</head>

<body>
    
    <h1> TodoList JSTL</h1>
    
    <div id="content">

    </div>
    <template id="TodoListTemplate">
        <h1>Hei og velkommen</h1>
    </template>

    <template id="authenticateUserUITemplate">
        <form>
            <label for="userName">User name:</label>
            <input type="text" id="userName">

            <label for="password">Password:</label>
            <input type="password" id="password">

            <label for="rememberMe">Remember Me:</label>
            <input type="checkbox" id="rememberMe">

            <button  id="loginBt" onclick="logInUser()">Login</button>
            <button type="button" id="createUserBt">Create User</button>
        </form>

    </template>

    <template id="createUserUITemplate">
        <form id="createUserForm">
            <label for="fullName">Full name:</label>
            <input type="text" id="fullName">
            
            <label for="userName">User name:</label>
            <input type="text" id="userName">

            <label for="email">E-mail:</label>
            <input type="email" id="email">

            <label for="password">Password:</label>
            <input type="password" id="password">

            <button>Create</button>
        </form>

    </template>
        
    
</body>
    
<script>
    
        let authenticatedUser = null;
        
        (function() {
            if (!authenticatedUser) {
                displayLoginForm();
            } else if (authenticatedUser) {
                displayTodoListTemplate();
            }
            
            else{
               console.log("ooooops");
            }
        })();
    
        function addElement(el){
            document.getElementById("content").appendChild(el);
        }
    
        function clearScreen(){
            let content = document.getElementById("content");
            content.innerHTML = ""
        }
    
        function createElementFromTemplate(templateID){
            let template = document.querySelector(templateID);
            let clone = document.importNode(template.content, true);
            return clone;
        }
    
        function displayLoginForm(){
            
            let loginForm = createElementFromTemplate("#authenticateUserUITemplate")
            //loginForm = window.document.body.appendChild(loginForm);
            addElement(loginForm);
            let loginBt = document.querySelector("#loginBt");
            let createBt = document.querySelector("#createUserBt");
            
            
            createBt.onclick = function(){
                clearScreen();
                displayCreateUserForm();
                console.log("Create user bt clicked")
            }
            
        }
    
        function logInUser(){
            console.log("Login bt clicked")

            let username = document.getElementById("userName").value;
            let password = document.getElementById("password").value;

            if(username.length > 1 && password.length > 1){
                fetch('/login/',{
                    method:"POST",
                    body:JSON.stringify({
                        userName:userName,
                        password:password
                    }),
                    headers: {
                        "Content-Type": "application/json; charset=utf-8"
                    },
                }).then(function(data){
                    if(data.status < 400){
                        return data.json();
                    }
                }).then(function(authenticatedUser){
                    if(authenticatedUser.id){
                        clearScreen();
                        displayTodoListTemplate();
                        console.log("Velkommeninn")
                    }
                }).catch(err =>{
                    console.error(err);

                });
            }
        }
        
        function displayCreateUserForm(){
            let element = createElementFromTemplate("#createUserUITemplate")
            window.document.body.appendChild(element);
            
            let form = document.getElementById("createUserForm");
            
            form.onsubmit = function(evt){
                
                evt.preventDefault();
                
                let fullName = document.getElementById("fullName").value;
                let userName = document.getElementById("userName").value;
                let email = document.getElementById("email").value;
                let password = document.getElementById("password").value;
                console.log("knapp trykket")
                
                fetch('/app/users',{
                    method:"POST",
                    body:JSON.stringify({
                        fullName:fullName,
                        userName:userName,
                        email:email,
                        password:password
                    }),
                    headers: {
                        "Content-Type": "application/json; charset=utf-8"
                    },
                    
                }).then(function(data){
                    if(data.status < 400){
                        return data.json();
                    }
                }).then(function(createdUser){
                    if(createdUser.id){
                        clearScreen();
                        displayLoginForm();
                    }
                }).catch(err =>{
                    console.error(err);
                
            });
            
           
        }
    
    
        function displayTodoListTemplate(){
    console.log("velkommen")
        }
        }
   </script>



</html>
    
